---
import { Zoom } from 'starlight-image-zoom/components';
import { Image } from 'astro:assets';

export interface Props {
  src: string;  // just the filename, like "simplified_architecture.png"
  alt: string;
}

const { src, alt } = Astro.props;

// Use import.meta.glob to statically import all diagram images
const images = import.meta.glob('../assets/diagrams/**/*.png', { eager: true }) as Record<string, { default: ImageMetadata }>;

// Build the paths to look up in the glob result
const lightPath = `../assets/diagrams/light/${src}`;
const darkPath = `../assets/diagrams/dark/${src}`;

// Get the imported images
const lightImage = images[lightPath]?.default;
const darkImage = images[darkPath]?.default;

if (!lightImage || !darkImage) {
  throw new Error(`Image not found: ${src}. Available images: ${Object.keys(images).join(', ')}`);
}
---

<Zoom label={alt}>
  <Image src={lightImage} alt={alt} class="dark:sl-hidden" loading="lazy" />
</Zoom>
<Zoom label={alt}>
  <Image src={darkImage} alt={alt} class="light:sl-hidden" loading="lazy" />
</Zoom>
